<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KESTREL AI | Tactical Defense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0ea5e9; --bg-dark: #050505; }
        body { background-color: var(--bg-dark); color: #cbd5e1; font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Tactical Background */
        .tactical-grid {
            position: fixed; inset: 0; z-index: -1;
            background-image: linear-gradient(rgba(14, 165, 233, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(14, 165, 233, 0.03) 1px, transparent 1px);
            background-size: 60px 60px;
        }
        
        /* Engineered Panel */
        .hud-panel {
            background: #0a0a0a; border: 1px solid #1e293b; position: relative;
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%);
        }
        .hud-panel::before {
            content: ''; position: absolute; top: 0; left: 0; width: 10px; height: 10px;
            border-top: 2px solid var(--primary); border-left: 2px solid var(--primary);
        }
        .hud-panel::after {
            content: ''; position: absolute; bottom: 0; right: 0; width: 20px; height: 2px;
            background: var(--primary); transform: rotate(-45deg); transform-origin: bottom right;
        }

        /* Tab Styling */
        .tab-btn {
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0% 100%);
            transition: all 0.3s ease;
        }
        .tab-active { background: #0ea5e9; color: black; font-weight: bold; border: none; }
        .tab-inactive { background: #0f172a; color: #64748b; border: 1px solid #1e293b; }
        .tab-inactive:hover { background: #1e293b; color: #94a3b8; }

        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-6 relative">

    <div class="tactical-grid"></div>

    <!-- Header -->
    <main class="w-full max-w-3xl relative z-10">
        <div class="flex items-end gap-4 mb-8 border-b border-slate-800 pb-4">
            <h1 class="text-6xl font-bold tracking-tighter text-white leading-none">KESTREL</h1>
            <div class="mb-1">
                <div class="text-xs bg-sky-600 text-black font-bold px-2 py-0.5 mono inline-block mb-1">MK.V</div>
                <div class="text-sm text-sky-500 tracking-widest font-bold">TACTICAL HUD</div>
            </div>
        </div>

        <!-- TAB SELECTION -->
        <div class="flex gap-2 mb-0 px-2">
            <button id="tab-url" class="tab-btn tab-active w-32 py-1 text-sm mono tracking-widest">[ URL_SCAN ]</button>
            <button id="tab-msg" class="tab-btn tab-inactive w-40 py-1 text-sm mono tracking-widest">[ MESSAGE_TXT ]</button>
        </div>

        <!-- Input Scanner Module -->
        <div class="hud-panel p-1 group">
            <div class="bg-[#0f1014] p-6 relative z-10 h-full border-l-4 border-sky-600/30">
                <div class="flex justify-between text-[10px] mono text-slate-500 mb-2 tracking-widest">
                    <span id="input-label">// TARGET_URL_INPUT</span>
                    <span>READY</span>
                </div>
                
                <textarea id="user-input" rows="3" 
                    placeholder="ENTER TARGET URL (e.g., http://sus-login.com)..." 
                    class="w-full bg-transparent border-none text-sky-100 placeholder-slate-700 text-lg focus:ring-0 resize-none mono leading-relaxed"
                ></textarea>
                
                <div class="flex justify-between items-center mt-4 pt-4 border-t border-slate-800/50">
                    <div class="text-xs text-slate-600 mono flex items-center gap-2">
                        <span class="w-1.5 h-1.5 bg-sky-500 rounded-full animate-pulse"></span>
                        HEURISTIC ENGINE ACTIVE
                    </div>
                    <button id="analyze-btn" class="bg-white hover:bg-sky-400 text-black hover:text-black px-6 py-2 font-bold mono text-sm tracking-wider transition-all">
                        [ INITIATE_SCAN ]
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Dashboard -->
        <div id="results-panel" class="mt-6 hidden">
            <div class="grid md:grid-cols-[2fr_1fr] gap-4">
                <!-- Main Report -->
                <div class="hud-panel p-6 bg-[#0f1014] border-l-4 border-slate-700" id="status-bar">
                    <div class="flex items-center gap-4 mb-6">
                        <div id="verdict-box" class="w-16 h-16 bg-slate-800 flex items-center justify-center font-bold text-2xl text-slate-500 border border-slate-600">?</div>
                        <div>
                            <div class="text-xs text-slate-500 uppercase font-bold">Threat Assessment</div>
                            <div id="verdict-text" class="text-3xl font-bold text-white tracking-tight">ANALYZING...</div>
                        </div>
                    </div>
                    <div class="border-t border-slate-800 pt-4">
                         <div class="text-xs text-sky-600 mono mb-2 uppercase">> Execution Summary</div>
                         <p id="summary-text" class="text-slate-300 text-sm leading-relaxed mb-4">Processing...</p>
                         <div class="text-xs text-sky-600 mono mb-2 uppercase">> Indicators</div>
                         <ul id="details-list" class="space-y-1 text-xs mono text-slate-400 h-24 overflow-y-auto"></ul>
                    </div>
                </div>

                <!-- Metrics Panel -->
                <div class="hud-panel p-6 bg-[#0f1014] flex flex-col justify-between">
                    <div class="text-[10px] mono text-slate-500 mb-2 tracking-widest">// RISK_METER</div>
                    <div class="relative w-full aspect-square flex items-center justify-center border border-slate-800 rounded-full bg-slate-900/50">
                        <svg class="w-full h-full transform -rotate-90 p-2">
                            <circle cx="50%" cy="50%" r="45%" fill="none" stroke="#1e293b" stroke-width="4"></circle>
                            <circle id="meter-ring" cx="50%" cy="50%" r="45%" fill="none" stroke="#0ea5e9" stroke-width="4"
                                stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="butt" class="transition-all duration-1000"></circle>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="risk-score" class="text-4xl font-bold text-white">0</span>
                            <span class="text-[9px] mono text-slate-500">THREAT IDX</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        const analyzeBtn = document.getElementById('analyze-btn');
        const userInput = document.getElementById('user-input');
        const resultsPanel = document.getElementById('results-panel');
        const tabUrl = document.getElementById('tab-url');
        const tabMsg = document.getElementById('tab-msg');
        const inputLabel = document.getElementById('input-label');
        let currentMode = 'url';

        // Tab Logic
        tabUrl.addEventListener('click', () => {
            currentMode = 'url';
            tabUrl.className = 'tab-btn tab-active w-32 py-1 text-sm mono tracking-widest';
            tabMsg.className = 'tab-btn tab-inactive w-40 py-1 text-sm mono tracking-widest';
            userInput.placeholder = "ENTER TARGET URL (e.g., http://sus-login.com)...";
            inputLabel.innerText = "// TARGET_URL_INPUT";
            resultsPanel.classList.add('hidden');
        });

        tabMsg.addEventListener('click', () => {
            currentMode = 'message';
            tabMsg.className = 'tab-btn tab-active w-40 py-1 text-sm mono tracking-widest';
            tabUrl.className = 'tab-btn tab-inactive w-32 py-1 text-sm mono tracking-widest';
            userInput.placeholder = "PASTE EMAIL OR SMS CONTENT HERE...";
            inputLabel.innerText = "// MESSAGE_BODY_INPUT";
            resultsPanel.classList.add('hidden');
        });

        analyzeBtn.addEventListener('click', async () => {
            const text = userInput.value.trim();
            if (!text) return;

            // UI Loading
            resultsPanel.classList.add('hidden');
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = "<span class='blink'>PROCESSING...</span>";
            userInput.disabled = true;

            try {
                // Detect Preview Mode
                const isPreview = window.location.protocol === 'file:' || window.location.protocol === 'blob:';
                
                let data;
                if (isPreview) {
                    await new Promise(r => setTimeout(r, 800));
                    // Simple local mock for preview
                    data = { verdict: "SAFE", risk_score: 5, summary: "Preview Mode: Backend required for full scan.", details: ["Local heuristic check passed."] };
                    if(text.includes('http')) data.verdict = "SUSPICIOUS"; 
                } else {
                    const response = await fetch('/api/analyze', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: text, type: currentMode })
                    });
                    data = await response.json();
                }
                
                displayResults(data);

            } catch (error) {
                console.error(error);
                alert("Scan failed. Check connection.");
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = "[ INITIATE_SCAN ]";
                userInput.disabled = false;
            }
        });

        function displayResults(data) {
            resultsPanel.classList.remove('hidden');
            
            // Elements
            const verdictText = document.getElementById('verdict-text');
            const verdictBox = document.getElementById('verdict-box');
            const statusBar = document.getElementById('status-bar');
            const meterRing = document.getElementById('meter-ring');

            verdictText.innerText = data.verdict;
            document.getElementById('summary-text').innerText = data.summary;
            document.getElementById('risk-score').innerText = data.risk_score;
            document.getElementById('details-list').innerHTML = data.details.map(d => `<li class="flex items-start"><span class="mr-2 text-slate-600">>></span> ${d}</li>`).join('');

            statusBar.className = "hud-panel p-6 bg-[#0f1014] border-l-4 transition-colors duration-500";
            
            if (data.verdict === 'MALICIOUS') {
                statusBar.classList.add('border-red-600');
                verdictText.className = "text-3xl font-bold text-red-500 tracking-tight";
                verdictBox.className = "w-16 h-16 bg-red-900/20 flex items-center justify-center font-bold text-2xl text-red-500 border border-red-500";
                verdictBox.innerText = "!";
                meterRing.style.stroke = "#dc2626"; 
            } else if (data.verdict === 'SUSPICIOUS') {
                statusBar.classList.add('border-amber-500');
                verdictText.className = "text-3xl font-bold text-amber-500 tracking-tight";
                verdictBox.className = "w-16 h-16 bg-amber-900/20 flex items-center justify-center font-bold text-2xl text-amber-500 border border-amber-500";
                verdictBox.innerText = "⚠️";
                meterRing.style.stroke = "#d97706";
            } else {
                statusBar.classList.add('border-emerald-500');
                verdictText.className = "text-3xl font-bold text-emerald-500 tracking-tight";
                verdictBox.className = "w-16 h-16 bg-emerald-900/20 flex items-center justify-center font-bold text-2xl text-emerald-500 border border-emerald-500";
                verdictBox.innerText = "✓";
                meterRing.style.stroke = "#059669";
            }

            const circumference = 283;
            const offset = circumference - (data.risk_score / 100) * circumference;
            setTimeout(() => { meterRing.style.strokeDashoffset = offset; }, 50);
        }
    </script>
</body>
</html>
